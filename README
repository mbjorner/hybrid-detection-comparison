Pipeline for the simulations with estimated gene trees (baseline case, other cases similar)
Claudia August 2015

WARNING: analyses done first with unrooted gene trees from 
MrBayes by mistake, all these results are in "unrooted" folders

1) Copy the ms folder from the knownGT folder

2) run: perl hgt_est_all.pl gamma=0.3 from=1 to=30
this will create per replicate: ?_mb.out (file with list of estimated trees) and ?_buckyCF.csv (table with estCF)
this perl script was modified from hgt_all.pl to do the loop on nloci too, but starts in nloci=30
because nloci=10 was done before
runs with nloci=10,30,100,300 were run with the old meanBL.r and the mean for nloci=10 was used for all priors, but this
was not fixed because the means are so close.
runs with nloci=1000,3000 were run with correct meanBL.r
this runs were made in darwin00 scratch/claudia/baseline because TICR scripts work better on scratch. 
Only the mb.out and CF.csv files are copied because all the output files are too heavy.

***after runs were done, we found that the gene trees were not rooted
correctly, so we had to reroot them we created the perl script
extractCONTREall.pl to copy the original .con.tre files from scratch in darwin00 to here
after, we have to run the R script: checkRootGT.r that will check if the gene trees
are rooted and root them with the true outgroup to run again hgt_all2 but only for phylonet

3) mv log files to a folder called estlogs so that we have separate logs for phylonet now

4) run perl hgt_all2.pl gamma=0.3 from=1 to=30
this will do the loop on nloci=10,30,100,300,1000,3000
** careful: we have two *mb.out, *mbRoot.out files, for phylonet we need *mbRoot.out 
created with checkRootGT.r
TODO: need to modify hgt2 to read mbRoot and to do only phylonet and run hgt_all2 again,
and do summary of phylonet only

5) run perl hgt_all3.pl gamma=0.3 from=1 to=??
after newBuckyAll.pl (in scratch darwin00) for nloci=300 runs that have some CF of 0.
hgt_all3.pl created simply because hgt_all2.pl was being run at the time of these new runs and did not want to modify it
to run only julia.
careful: hgt3.pl might be running astral and phylonet as well now, modified at the end

# from here on, copied from knownGT/baselineNet/README:
# perl/r scripts need not to be modified because the summary is identical for knownGT-estGT

# before summarize, copy in debug folder to have backup 
2) Run: perl summarizeOutputAstralAll.pl, perl summarizeOutputPhylonetAll.pl, perl
summarizeOutputJuliaAll.pl to put all estimated trees and networks in
a same file: estTrees.out/estNetworks.out inside each folder (and
time.out for the julia folders) needs summarizeOutputAstralPath.pl,
summarizeOutputPhylonetPath.pl, summarizeOutputJuliaPath.pl

# there were issues with the root on phylonet estNetworks:
2.5) run ~/software/julia/julia/julia rerootNet.jl
this will go into each phylonet file for every nloci, and will read estNetworks.out
and create estNetworksRoot.out with the rooted networks
make sure that the outgroup is correctly defined in the julia script
warning: can only be run in darwin computers, and it is not used at the end
because we had to redo phylonet analyses with rooted gene trees: *mbRoot.out

# warning: changed PhylonetCmpnets2 to read estNetworksRoot.out
# instead of estNetworks.out because the other one is useless
# with the wrong root
# this is only needed for phylonet, if running for julia, need to switch back
3) Run: perl PhylonetCmpnetsAll.pl, perl PhylonetSymmDistAll.pl to
calculate the distances between the true/network to the estimated
trees/networks by astral/phylonet: distances.out inside each folder.
you can also run PhylonetCmpnetsAll.pl for julia folder, only need to
get inside and change the path to "julia" needs PhylonetCmpnets.pl,
PhylonetSymmDist.pl PhylonetCmpnets2.pl has the new distance function:
phylonet.jar

3.5) Create the file otherNetworks.out in the same path as the perl
scripts with the other networks close to the true network (make sure no trailing newline)
Run: perl PhylonetCmpnetsOthersAll.pl 
this will go into all paths in julia/phylonet (need to specify which in PhylonetCmpnetsOthers.pl)
and compare estNetworks.out to each one of the otherNetworks.out, and will create a
distances?.out file for each of the otherNetworks

# before this: make sure to have only one log file per scenario:gamma,nloci
# at least for the phylonet analyses. here we had to redo snaq analyses for nloci=300
# which is why there were many extra log files, which will simply move to logfiles/extraSnaq
4) Run: perl PhylonetTime.pl gamma=... nloci=...
to summarize the log files and extract the running time of phylonet
creates gamma_ _nloci_.time file with table with times per replicate
here: gamma=0.3, nloci=10,30,100,300,1000,3000

** warning: need to modify r scripts to current number of gammas (that is, the path)
5) Run in R summarizeDistances.r which creates a table with
frequencies of each distance for phylonet and julia, still not correct
because same distance does not imply same network, still need to think
this better: works for luay distance if same root
creates statdf also with mean dist, sd dist and true network proportion

5.5) Run in R summarizeDistancesOthers.r.
warning: need to specify the number of other networks in otherNetworks.out
before running the script.
this will create statdfall.txt(Rda) with a table of frequencies for the 
true network and other networks

6) Run in R summarizeTimes.r to summarize phylonet and julia times, 
create gamma0.1timePhylonet.txt (.Rda) and gamma0.1timeJulia.txt (.Rda)
fixit: save also sd of time, not only mean!
warning: need to be careful with times of 23hours, need to modify this by hand in the code

7) Run in R uniteStatdf.r to create a table with mean dist, sd dist and proportion
of true network: gamma0.1statdfjulia(phylonet).txt(.Rda)

7.5) Run in R uniteStatdfall.r to create a table with true net proportion and 
proprtion for other networks (the ones in otherNetworks.out joined by type of move).
Be careful, this R script is very particular to baseline and will need to be
entirely modified with other cases

8) move *.log,*.time files to directory logfiles/, and move all
*.Rda,*.txt (except README) file to outfiles/

# create a figures folder
9) plots: plots.r has initial idea on how to do the plots
** warning: compare the Rda file to the txt files, found errors

*** We also want to count the number of times that the unrooted estimated network
matches the unrooted true network, but the position of the root made this impossible to
test with the distance function (see ipad notes)
We will do this manually:
Get into each folder in julia/gamma0.3_n*, open estNetworks.out and check all the networks that do not
start with (6,...
Plot them in Dendroscope and compare to the true unrooted network.
Then, add this quantity X/30 to the frequency of sameTop in the plots

